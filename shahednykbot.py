import asyncio
import logging
import os
from telethon import TelegramClient, events
from telegram import Bot
import random

# üîê –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
api_id = 26549615
api_hash = 'f43d6245868e5bae41c40872fb873dec'
bot_token = '7395027911:AAGkiRcvxs8hP878uv9nvo5mGwDe39loxFg'
chat_id = -2416827567
  # üëà –∑–∞–º—ñ–Ω–∏ –Ω–∞ ID —Å–≤–æ—î—ó –≥—Ä—É–ø–∏

client = TelegramClient('anon', api_id, api_hash)
bot = Bot(token=bot_token)

# üîë –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞
keywords = ['—à–∞—Ö–µ–¥', '—Ä–∞–∫–µ—Ç–∞', '—ñ—Å–∫–∞–Ω–¥–µ—Ä', '–∫—ñ–Ω–∂–∞–ª', '–±–ø–ª–∞', '–¥—Ä–æ–Ω', '–ø–ø–æ', '–ª–µ—Ç–∏—Ç—å', '–ø—Ä–∏–ª—ñ—Ç', '–∑–∞–≥—Ä–æ–∑–∞', '—É–¥–∞—Ä']
banwords = ['–¥–æ–Ω–∞—Ç', '–º–æ–Ω–æ–±–∞–Ω–∫–∞', '–ø—ñ–¥–ø–∏—Å—É–π—Ç–µ—Å—å', '–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞', '–∑–∞—è–≤–∞', '–ø–æ–ª—ñ—Ç–∏–∫–∞', '–ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ', '–∑–∞–∫–ª–∏–∫']

# üòÇ –ñ–∞—Ä—Ç–∏
jokes_default = [
    
    'üí© –õ–µ—Ç–∏—Ç—å –≥—ñ–≤–Ω–æ ‚Äî —è–∫ –∑–∞–≤–∂–¥–∏ –ø–æ –≥—Ä–∞—Ñ—ñ–∫—É!',
    'üßª –ü—Ä–∏–ª–µ—Ç—ñ–ª–∞ —Å—Ä...–∞ ‚Äî —Ç—Ä–∏–º–∞–π —Ç—É–∞–ª–µ—Ç!',
    'ü™ñ –ö—ñ–Ω–∂–∞–ª –ª–µ—Ç–∏—Ç—å ‚Äî –∑–∞—Ö–æ–≤–∞–π—Å—è –≤ –∫–∞—Å—Ç—Ä—É–ª—é!',
    'üß† –ü–ü–û –ø—Ä–∞—Ü—é—î, –∞ —Ç–∏ –ø—Ä–∞—Ü—é–π –Ω–∞–¥ —Å–æ–±–æ—é!',
    'üî• –†–∞–∫–µ—Ç–∞ –Ω–∞ –ø—ñ–¥–ª—å–æ—Ç—ñ ‚Äî –Ω–µ –ø–∞–Ω—ñ–∫—É–π, –≥–æ—Ä–∏ —Å–ø–æ–∫—ñ–π–Ω–æ!',
    'üí© –©–æ—Å—å –ª–µ—Ç–∏—Ç—å, —Ç—Ä–∏–º–∞–π –∫–∞—Å–∫—É!',
    'üî• –ü—Ä–∏–ª—ñ—Ç –±—É–¥–µ —Å–º–∞—á–Ω–∏–π, —Å—Ö–æ–≤–∞–π —Å—Ä–∞–∫—É!',
    'üõ∏ –ü–æ–≥–∞–Ω—ñ —à–∞—Ö–µ–¥–∏–∫–∏ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ñ!',
    'üì° –¢—Ä–∏–≤–æ–≥–∞ –≤ –µ—Ñ—ñ—Ä—ñ, —Ö–æ–≤–∞–π—Å—è —è–∫ –º–æ–∂–µ—à!',
    'ü§ñ –ì–æ–≤–Ω–æ –≤ –Ω–µ–±—ñ, —Ç—Ä–∏–º–∞–π –æ–±–æ—Ä–æ–Ω—É!',
    'üí£ –û–±—ñ–π–º–∏ –±–µ—Ç–æ–Ω ‚Äî –ø—Ä–∏–ª–µ—Ç–∏—Ç—å —â–æ—Å—å –≥–∞—Ä—è—á–µ!',
    'üßª –ë–µ—Ä–∏ —Ç—Ä—É—Å–∏ –Ω–∞ –∑–∞–ø–∞—Å ‚Äî –±—É–¥–µ –≥–æ–ª–æ—Å–Ω–æ!',
    'ü´† –ù–µ –±–æ–π—Å—è, —Ç–∏ –ø—Ä–æ—Å—Ç–æ NPC –≤ —Ü—ñ–π –≥—Ä—ñ!',
    'üå™Ô∏è –•–º–∞—Ä–∏ –¥–∏–≤–Ω—ñ, —á–∏ —Ç–æ –≤–∂–µ –ª–µ—Ç–∏—Ç—å?',
    'üß® –©–æ—Å—å –¥–∑–≤–µ–Ω–∏—Ç—å, –º–æ–∂–µ —Ç–æ –Ω–µ –≤ –≤—É—Ö–∞—Ö?',
    'üì¢ –û–≥–æ–ª–æ—à–µ–Ω–Ω—è: –ª–µ—Ç–∏—Ç—å –ª–∞–π–Ω–æ. –•–æ–≤–∞–π—Å—è!',
    'üì¶ –î–æ—Å—Ç–∞–≤–∫–∞: Shahed Prime, –±–µ–∑ –ø—ñ–¥–ø–∏—Å—É!',
    'üèÉ‚Äç‚ôÇÔ∏è –ë—ñ–∂–∏, –õ–æ–ª–æ, –±—ñ–∂–∏!',
    'üòµ‚Äçüí´ –†–∞–∫–µ—Ç–∞ –ø—Ä–æ–ª–µ—Ç—ñ–ª–∞? –ß–∏ —Ç–æ –≥–æ–ª—É–±?',
    'üìâ –†—ñ–≤–µ–Ω—å —Å–ø–æ–∫–æ—é: –º—ñ–Ω—É—Å –ø‚Äò—è—Ç—Å–æ—Ç',
    'üò¨ –ù–µ —Å—Ü–∏, —Å—Ü–∏ –æ–±–µ—Ä–µ–∂–Ω–æ!',
    'üï≥Ô∏è –¢–≤—ñ–π —É–Ω—ñ—Ç–∞–∑ ‚Äî –Ω–∞–π–∫—Ä–∞—â–∏–π –±—É–Ω–∫–µ—Ä',
    'ü•∂ –ì—É—Å–∏ –º–æ–≤—á–∞—Ç—å ‚Äî –∑–Ω–∞—á–∏—Ç—å –≤–∂–µ –±–ª–∏–∑—å–∫–æ',
    'üõë –ú–æ–∑–æ–∫ –∫–∞–∂–µ "—Ç–∏ –≤–¥–æ–º–∞", –∞ —à–∞—Ö–µ–¥ –∫–∞–∂–µ "–ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ"',
    'üòà –£ –∫–æ–≥–æ —î –∂–∏—Ç–ª–æ –≤ –ü–æ–ª—å—â—ñ ‚Äî —á–∞—Å –∑–≥–∞–¥–∞—Ç–∏!',
    'üì¶ –ü—Ä–∏–ª–µ—Ç—ñ–≤ –ø–æ–¥–∞—Ä—É–Ω–æ–∫ –∑ –º–æ—Å–∫–æ–≤—Å—å–∫–æ—ó –ª—é–±–æ–≤‚Äô—é!',
    'üîä –°–∞—É–Ω–¥—Ç—Ä–µ–∫ –¥–æ –∂–∏—Ç—Ç—è: "–≤–∏–∏–∏–∏–∏–∏–∏–∏–∏—É—É—É—É—É!"',
    'ü´° –í–∫–ª—é—á–∏ –¥—É—Ä–Ω–∏–∫–∞ ‚Äî –º–æ–∂–µ –Ω–µ –ø–æ–º—ñ—Ç—è—Ç—å',
    'üïµÔ∏è‚Äç‚ôÇÔ∏è –°–∏–¥–∂—É –≤ —Ç—É–∞–ª–µ—Ç—ñ —è–∫ –î–∂–µ–π–º—Å –ë–æ–Ω–¥',
    'üßΩ –ü—Ä–æ—Ç—Ä—ñ—Ç—å –≤—ñ–∫–Ω–∞. –û—Å—Ç–∞–Ω–Ω—ñ–π —Ä–∞–∑, –º–æ–∂–µ',
    'üëÉ –ß—É—î—à? –¶–µ —Ç—Ä–∏–≤–æ–≥–∞ —á–∏ –±–æ—Ä—â?',
    'üëã –°–∫–∞–∂–∏ –º–∞–º—ñ, —â–æ –ª—é–±–∏—à —ó—ó. –ù—É —Ç–∞–∫, –Ω–∞ –≤—Å—è–∫',
    'üöΩ –Ø–∫—â–æ —Å–º–µ—Ä–¥–∏—Ç—å ‚Äî —Ü–µ –Ω–µ –ø–∞–Ω—ñ–∫–∞, —Ü–µ —Ç–∏',
    'üí§ –ó–∞—Å–Ω—É–≤? –ù—É —Ç–æ —Ç–µ–ø–µ—Ä —Ç–æ—á–Ω–æ –ø—Ä–æ–∫–∏–Ω–µ—à—Å—è',
    'üß† –î—É–º–∞–π —à–≤–∏–¥–∫–æ! –ê, –≤–∂–µ –ø—ñ–∑–Ω–æ',
    'ü•∏ –Ø–∫—à–æ –º–æ–≤—á–∏—à ‚Äî –º–æ–∂–µ –ø–æ–¥—É–º–∞—î —â–æ —Ç–µ–±–µ –Ω–µ–º–∞',
    'üèöÔ∏è –ó‚Äô—ó–∂ –∑ –ø—ñ–¥–≤—ñ–∫–æ–Ω–Ω—è, —Ç–∏ –Ω–µ –≥–æ–ª—É–±!',
    'ü¶Ü –®–∞—Ö–µ–¥ –∞–±–æ –∫–∞—á–∫–∞ ‚Äî —Ä—É–ª–µ—Ç–∫–∞ –∂–∏—Ç—Ç—è!',
    'üåà –£ –∫–æ–≥–æ –±—Ä–æ–Ω—ñ–∫ –∑ –±–ª–∏—Å–∫—ñ—Ç–∫–∞–º–∏ ‚Äî —Ç—ñ –Ω–µ–ø–æ–º—ñ—Ç–Ω—ñ',
    'üîï –í–∏–º–∫–Ω–∏ –∑–≤—É–∫. –†–∞–∫–µ—Ç–∞ –∂ –Ω–µ –≥–ª—É—Ö–∞!',
    'ü•¥ "–ù–µ –ø—Ä–∏–ª–µ—Ç–∏—Ç—å –ø–æ –º–µ–Ω—ñ" ‚Äî –≤—ñ–¥–æ–º—ñ –æ—Å—Ç–∞–Ω–Ω—ñ —Å–ª–æ–≤–∞',
    'ü´£ –†—É–∫–∏ –≤–≥–æ—Ä—É! –ê–∞–∞, –Ω—ñ, —Ü–µ –Ω–µ –û–ú–û–ù...',
    'üéâ –°–≤—è—Ç–æ –Ω–∞–±–ª–∏–∂–∞—î—Ç—å—Å—è ‚Äî —É –≤–∏–≥–ª—è–¥—ñ –æ–±—Å—Ç—Ä—ñ–ª—É!',
    'üì¶ –õ–µ—Ç–∏—Ç—å –ø–æ—Å–∏–ª–∫–∞ –±–µ–∑ —Ç—Ä–µ–∫-–∫–æ–¥—É',
    'üßÉ –Ø–∫—â–æ –∑—Ä–∞–Ω–∫—É ‚Äî —Ç–æ —Ü–µ –∫–∞–≤–æ—É–¥–∞—Ä',
    'üìõ –í–∏–π—à–æ–≤ –Ω–∞–¥–≤—ñ—Ä? –¢–µ–ø–µ—Ä –∂–∏–≤–µ—à —É –±–æ–π–æ–≤–∏–∫—É',
    'ü™¶ –Ø–∫—â–æ —Ç–∏—à–∞ ‚Äî —Ü–µ –Ω–µ –¥–æ–±—Ä–µ, —Ü–µ –¥—É–∂–µ –ø–æ–≥–∞–Ω–æ',
    'üêñ –ü—Ä–∏–ª—ñ—Ç –ø–æ —Ö–ª—ñ–≤—É ‚Äî —Ç–æ –≤–∂–µ —Å–≤–∏–Ω—Å—Ç–≤–æ',
    'üßº –ü–æ–º–∏–≤—Å—è? –î–∞—Ä–º–∞ ‚Äî –±—É–¥–µ –∑–Ω–æ–≤—É –ø–∏–ª—é–∫–∞',
    'üíÖ –®–∞—Ö–µ–¥–∏–∫ –ø—ñ–¥–ª–µ—Ç—ñ–≤ –Ω–∞ –º–∞–Ω—ñ–∫—é—Ä',
    'üß† –ó–∞–ø–∞–º‚Äô—è—Ç–∞–π: —Å–ø–æ—á–∞—Ç–∫—É "–≤–∏–∏–∏–∏", –ø–æ—Ç—ñ–º "–±—É–º!"',
    'ü•π –ù–µ —Å—Ü–∏, —Ç–∏ –Ω–µ –æ–¥–∏–Ω. –ú–∏ –≤—Å—ñ —Ç—É—Ç —Å—Ä–µ–º–æ —Ä–∞–∑–æ–º',
    
]

jokes_volyn = [
    'üêΩ –í–æ–ª–∏–Ω—å, –ø—Ä–∏—Ç–∏—Å–∫–∞–π—Å—è –¥–æ –∫–∞–±–∞–Ω–∞!',
    'üßÖ –ö–æ–≤–µ–ª—å, —Ç—Ä–∏–º–∞–π –≥–æ–ª–æ–≤—É –≤ –±—É—Ä—è–∫–∞—Ö!',
    'üõ¢Ô∏è –ü—Ä–∏–ª—ñ—Ç –Ω–∞–¥ –í–æ–ª–∏–Ω–Ω—é ‚Äî –∞ –º–∏ —Ç—ñ–ª—å–∫–∏ —Å–∞–ª–æ –∑–∞–∫–æ–ø–∞–ª–∏!',
    'ü™ñ –í–æ–ª–∏–Ω—å, —Å—Ö–æ–≤–∞–π—Å—å! –í–∂–µ –ª–µ—Ç–∏—Ç—å!',
    'üìç–ö–∞—Ä—Ç–∞ –í–æ–ª–∏–Ω—ñ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞. –ì–æ—Ç—É–π—Å—è!',
    'üìç –í—ñ—Ç–∞—î–º–æ —É –í–æ–ª–∏–Ω—Å—å–∫—ñ–π –∑–æ–Ω—ñ —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç—ñ',
]

def get_joke(message_text):
    volyn_keywords = ['–≤–æ–ª–∏–Ω', '–ª—É—Ü—å–∫', '–∫–æ–≤–µ–ª—å', '–≤–æ–ª–æ–¥–∏–º–∏—Ä', '–≤–æ–ª–∏–Ω—Å—å–∫–∞']
    lower_msg = message_text.lower()
    if any(keyword in lower_msg for keyword in volyn_keywords):
        return random.choice(jokes_volyn)
    return random.choice(jokes_default)

recent_ids = set()

# üì¶ –û–±—Ä–æ–±–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
@client.on(events.NewMessage)
async def handler(event):
    try:
        if event.id in recent_ids:
            return
        recent_ids.add(event.id)
        text = event.message.message or ''
        text_lower = text.lower()

        # ‚ùå –§—ñ–ª—å—Ç—Ä —Å–ø–∞–º—É
        if any(bad in text_lower for bad in banwords):
            return
        # ‚úÖ –§—ñ–ª—å—Ç—Ä —à–∞—Ö–µ–¥—ñ–≤
        if not any(word in text_lower for word in keywords):
            return

        # üì∏ –Ø–∫—â–æ —î —Ñ–æ—Ç–æ ‚Äî –Ω–∞–¥—Å–∏–ª–∞—î–º–æ –æ–∫—Ä–µ–º–æ
        if event.photo:
            file = await event.download_media()
            await bot.send_photo(chat_id=chat_id, photo=open(file, 'rb'))
            os.remove(file)

        # üß† –í–∏–±—ñ—Ä –∂–∞—Ä—Ç—É
        if '–≤–æ–ª–∏–Ω' in text_lower or '–ª—É—Ü—å–∫' in text_lower or '–∫–æ–≤–µ–ª—å' in text_lower:
            joke = random.choice(jokes_volyn)
        elif text.count('!') >= 3:
            joke = 'üö® –©–æ—Å—å —Å—Ç—Ä—å–æ–º–Ω–µ –ª–µ—Ç–∏—Ç—å! –ü—Ä–∏—Ç–∏—Å–Ω–∏—Å—å –¥–æ –±–µ—Ç–æ–Ω—É!'
        else:
            joke = random.choice(jokes_default)

        # üì§ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ –≥—Ä—É–ø—É
        await bot.send_message(chat_id=chat_id, text=f"<b>{joke}</b>\n\n{text}", parse_mode='HTML')

    except Exception as e:
        logging.error(f'‚ùå Error: {e}')

# üöÄ –ó–∞–ø—É—Å–∫
async def main():
    await client.start()
    print('‚úÖ Shahedyk –∑–∞–ø—É—â–µ–Ω–æ.')
    await client.run_until_disconnected()

if __name__ == '__main__':
    logging.basicConfig(level=logging.INFO)
    asyncio.run(main())
